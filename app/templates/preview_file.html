<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Preview File</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    html, body { margin:0; padding:0; height:100vh; width:100vw; }
    #preview-container { width:100%; height:100%; }
    iframe, img, video, audio { width:100%; height:100%; border:none; display:block; }
  </style>
</head>
<body>
<div id="preview-container"></div>

<script>
const fileUrl = "{{ file_url }}";
const ext = "{{ filename.split('.')[-1]|lower }}";
const container = document.getElementById("preview-container");

if(['docx','pptx','pdf','doc','ppt'].includes(ext)) {
    // Google Docs Viewer
    const iframe = document.createElement('iframe');
    iframe.src = `https://docs.google.com/gview?url=${encodeURIComponent(fileUrl)}&embedded=true`;
    container.appendChild(iframe);

} else if(ext === 'xlsx' || ext === 'xls') {
    // XLSX preview
    fetch(fileUrl)
    .then(res => res.arrayBuffer())
    .then(data => {
        const workbook = XLSX.read(data, { type: "array" });
        const sheetName = workbook.SheetNames[0];
        const html = XLSX.utils.sheet_to_html(workbook.Sheets[sheetName]);
        const iframe = document.createElement('iframe');
        container.appendChild(iframe);
        iframe.contentDocument.open();
        iframe.contentDocument.write(html);
        iframe.contentDocument.close();
    })
    .catch(err => {
        container.innerHTML = `<p>Gagal menampilkan XLSX. <a href="${fileUrl}" target="_blank">Download</a></p>`;
        console.error(err);
    });

} else if(['png','jpg','jpeg','gif','bmp','webp'].includes(ext)) {
    const img = document.createElement('img');
    img.src = fileUrl;
    container.appendChild(img);

} else if(['mp4','webm','ogg'].includes(ext)) {
    const video = document.createElement('video');
    video.src = fileUrl;
    video.controls = true;
    container.appendChild(video);

} else if(['mp3','wav','ogg'].includes(ext)) {
    const audio = document.createElement('audio');
    audio.src = fileUrl;
    audio.controls = true;
    container.appendChild(audio);

} else {
    container.innerHTML = `<p>Preview tidak tersedia. <a href="${fileUrl}" target="_blank">Download</a></p>`;
}
</script>
</body>
</html>
